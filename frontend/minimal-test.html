<!DOCTYPE html>
<html>
<head><title>Minimal WebSocket Test</title></head>
<body>
<h1>Minimal WebSocket Test</h1>
<div id="output"></div>
<script>
console.log('Script starting...');
document.getElementById('output').innerHTML = 'Script loaded<br>';

setTimeout(() => {
    console.log('Creating WebSocket...');
    document.getElementById('output').innerHTML += 'Creating WebSocket...<br>';
    
    const ws = new WebSocket('ws://localhost:8765');
    
    ws.onopen = function(event) {
        console.log('ONOPEN FIRED!', event);
        document.getElementById('output').innerHTML += 'ONOPEN FIRED!<br>';
        
        // Send auth immediately
        const auth = {type: 'authenticate', username: 'test', password: 'passpass'};
        console.log('Sending:', auth);
        ws.send(JSON.stringify(auth));
        document.getElementById('output').innerHTML += 'Auth sent<br>';
    };
    
    ws.onmessage = function(event) {
        console.log('MESSAGE:', event.data);
        document.getElementById('output').innerHTML += 'Message: ' + event.data + '<br>';
    };
    
    ws.onclose = function(event) {
        console.log('CLOSE:', event.code, event.reason);
        document.getElementById('output').innerHTML += 'Closed: ' + event.code + '<br>';
    };
    
    ws.onerror = function(error) {
        console.log('ERROR:', error);
        document.getElementById('output').innerHTML += 'Error: ' + error + '<br>';
    };
    
    document.getElementById('output').innerHTML += 'Handlers attached<br>';
    
}, 1000);
</script>
</body>
</html>
